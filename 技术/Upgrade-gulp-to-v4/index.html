<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>将gulp升级至船新的第4代徐凯的博客</title><link rel="stylesheet" href="https://cdn.bootcss.com/material-components-web/2.3.1/material-components-web.min.css"><link rel="stylesheet" href="/css/common.css"></head><body><aside class="mdc-drawer mdc-drawer--modal"><div class="mdc-drawer__header mdc-ripple-surface avatar-card" data-mdc-auto-init="MDCRipple"><img class="avatar" src="/img/avatar.png" alt><div> <h3 class="mdc-drawer__title">徐凯</h3><h6 class="mdc-drawer__subtitle">xukai@email.com</h6></div></div><div class="mdc-drawer__content">       <div class="mdc-list site-menu"><div class="categories-menu"><hr class="mdc-list-divider"><h6 class="mdc-list-group__subheader">分类</h6><a class="mdc-list-item mdc-list-item--activated" href="/categories/杂谈" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">杂谈</span></a><a class="mdc-list-item mdc-list-item--activated" href="/categories/技术" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">技术</span></a><a class="mdc-list-item mdc-list-item--activated" href="/categories/test" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">test</span></a></div><div class="theme-menu"><hr class="mdc-list-divider"><h6 class="mdc-list-group__subheader">导航</h6><a class="mdc-list-item mdc-list-item--activated" href="/" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">Home</span></a><a class="mdc-list-item mdc-list-item--activated" href="/about" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">About</span></a><a class="mdc-list-item mdc-list-item--activated" href="/archives" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">Archives</span></a></div></div></div></aside><div class="mdc-drawer-scrim"></div><header class="mdc-top-app-bar" id="app-bar"><div class="mdc-top-app-bar__row"><section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start"><a class="material-icons mdc-top-app-bar__navigation-icon" href="#">menu</a><span class="mdc-top-app-bar__title">徐凯的博客</span></section><nav class="blog-nav"><div class="nav-surface mdc-ripple-surface" data-mdc-auto-init="MDCRipple">           <a href="/">首页</a></div><div class="nav-surface mdc-ripple-surface" data-mdc-auto-init="MDCRipple">           <a href="/about">关于</a></div><div class="nav-surface mdc-ripple-surface" data-mdc-auto-init="MDCRipple">           <a href="/archives">归档</a></div></nav></div></header><div id="content-outer"><div id="content-inner"><div class="main-post"><article id="post"><h1>将gulp升级至船新的第4代</h1><h6 class="mdc-typography--subtitle1 row"><div class="post-data"><i class="material-icons mdc-chip__icon mdc-chip__icon--leading">date_range </i><span>2018-04-25</span></div><div class="post-tags"><i class="material-icons mdc-chip__icon mdc-chip__icon--leading">local_offer          </i><a href="/tags/gulp/">gulp</a></div></h6><p>众所周知，前端不算程序员，毕竟什么样的人都能经过培训班3个月的培训进入这个行业。虽然入行门槛极低，但上线却一点也不低，各种水平的人鱼龙混杂。常年抱怨学不动的一小部分人，拉低了整个行业水平，也平均了行业的薪资水平。</p>
<p>有时候我也在怀疑是不是入错了行，但又架不住对技术钻研的兴趣，和学到新东西的满足感，一头扎进代码里继续折腾。</p>
<p>前端一直以来都是用当前的技术实现，写着将来才会被完整支持的代码。正是node给这一切提供了舞台，让这种魔幻的事情变为可能，而gulp的出现，颇具几分工业革命的味道，代码经过流水线上各个工具处理，每项功能都各司其职，最终生产出标准产品。</p>
<p>对于一般项目而言，最初搭建的环境依赖是万万动不得的，牵一发而动全身，一处改动，满屏报错。借着gulp换代升级之际，我也想让项目跟上时代的脚步，感受船新的编程体验。</p>
<p>首先我将项目依赖的gulp版本和cli都升到了4，运行是肯定不敢运行的，只能是先看看官方文档这样子。</p>
<p>这一版比较大的变动就是集成了 sequence 功能，使用 <code>series()</code>  和  <code>parallel()</code> 语法来串接或并发任务，如果之前的项目使用过 “gulp-sequence” 插件，这块改动起来非常简单，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 gulp-sequence 的语法</span></span><br><span class="line">gulp.task(<span class="string">'build'</span>, gulpSequence(</span><br><span class="line">  <span class="string">'clean'</span>, [   </span><br><span class="line">    <span class="string">'scripts'</span>,</span><br><span class="line">    <span class="string">'styles'</span>,    </span><br><span class="line">    <span class="string">'images'</span></span><br><span class="line">  ]</span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="comment">//gulp4的语法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> series(clean, parallel(</span><br><span class="line">    scripts,</span><br><span class="line">    styles,</span><br><span class="line">    images</span><br><span class="line">    ))</span><br></pre></td></tr></table></figure>
<p>这块理解起来难度不大，而且es6语法写的超级爽。对异步的支持让代码逻辑更加清晰，照搬一个官网的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncAwaitTask</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; version &#125; = fs.readFileSync(<span class="string">'package.json'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(version);</span><br><span class="line">  <span class="keyword">await</span> <span class="built_in">Promise</span>.resolve(<span class="string">'some result'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.default = asyncAwaitTask;</span><br></pre></td></tr></table></figure>
<p>支持了 async/await 语法，而且模块化会让我们更好的拆分和组织任务，每一个函数都可以是一个独立的任务。</p>
<p>大概看一下文档，对于旧项目改造的地方也不算太多，不知道性能上能提升多少，单就语法上的改造就很爽了，当项目运行起来的那一刻，这番折腾也算值得。对了，看文档的时候发现 gulp4 还使用了 Chokidar 这个库，这里赞一个，我有时候也用到这个工具，这是一个非常优秀的库，解决了fs的许多痛点，用来监控文件非常棒。</p>
<div id="paginator"></div><span class="leancloud-visitors" id="技术/Upgrade-gulp-to-v4/index.html" data-flag-title="将gulp升级至船新的第4代"><em class="post-meta-item-text">阅读量 </em><i class="leancloud-visitors-count">1000000+</i></span><div id="valine"> </div></article><nav id="postnav"></nav></div></div></div><div id="bottom-outer"><h6 class="mdc-typography--subtitle1">©POWERED BY HEXO | THEME: XUKAI</h6><button class="mdc-fab" id="gotop" aria-label="arrow_upward" data-mdc-auto-init="MDCRipple"><span class="mdc-fab__icon material-icons">arrow_upward</span></button></div><script src="https://cdn.bootcss.com/material-components-web/2.3.1/material-components-web.min.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/js/Valine.min.js"></script><script src="/js/common.js"></script></body></html>