<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>个人正则表达式备忘录徐凯的博客</title><link rel="stylesheet" href="https://cdn.bootcss.com/material-components-web/2.3.1/material-components-web.min.css"><link rel="stylesheet" href="/css/common.css"></head><body><aside class="mdc-drawer mdc-drawer--modal"><div class="mdc-drawer__header mdc-ripple-surface avatar-card" data-mdc-auto-init="MDCRipple"><img class="avatar" src="/img/avatar.png" alt><div> <h3 class="mdc-drawer__title">徐凯</h3><h6 class="mdc-drawer__subtitle">xukai@email.com</h6></div></div><div class="mdc-drawer__content">       <div class="mdc-list site-menu"><div class="categories-menu"><hr class="mdc-list-divider"><h6 class="mdc-list-group__subheader">分类</h6><a class="mdc-list-item mdc-list-item--activated" href="/categories/杂谈" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">杂谈</span></a><a class="mdc-list-item mdc-list-item--activated" href="/categories/技术" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">技术</span></a><a class="mdc-list-item mdc-list-item--activated" href="/categories/test" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">test</span></a></div><div class="theme-menu"><hr class="mdc-list-divider"><h6 class="mdc-list-group__subheader">导航</h6><a class="mdc-list-item mdc-list-item--activated" href="/" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">Home</span></a><a class="mdc-list-item mdc-list-item--activated" href="/about" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">About</span></a><a class="mdc-list-item mdc-list-item--activated" href="/archives" data-mdc-auto-init="MDCRipple"><i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i><span class="mdc-list-item__text">Archives</span></a></div></div></div></aside><div class="mdc-drawer-scrim"></div><header class="mdc-top-app-bar" id="app-bar"><div class="mdc-top-app-bar__row"><section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start"><a class="material-icons mdc-top-app-bar__navigation-icon" href="#">menu</a><span class="mdc-top-app-bar__title">徐凯的博客</span></section><nav class="blog-nav"><div class="nav-surface mdc-ripple-surface" data-mdc-auto-init="MDCRipple">           <a href="/">首页</a></div><div class="nav-surface mdc-ripple-surface" data-mdc-auto-init="MDCRipple">           <a href="/about">关于</a></div><div class="nav-surface mdc-ripple-surface" data-mdc-auto-init="MDCRipple">           <a href="/archives">归档</a></div></nav></div></header><div id="content-outer"><div id="content-inner"><div class="main-post"><article id="post"><h1>个人正则表达式备忘录</h1><h6 class="mdc-typography--subtitle1 row"><div class="post-data"><i class="material-icons mdc-chip__icon mdc-chip__icon--leading">date_range </i><span>2016-08-06</span></div><div class="post-tags"><i class="material-icons mdc-chip__icon mdc-chip__icon--leading">local_offer          </i><a href="/tags/正则表达式/">正则表达式</a></div></h6><p>正则表达式是一种高效的工具，对于程序员而言，应该是信手拈来的基本功，但随着发际线的后移，部分记忆也玩起了捉迷藏，时而需要查查手册文档之类的，抽个空档对这块的小知识做个备份，以备不时之需。</p>
<h3 id="基础符号"><a href="#基础符号" class="headerlink" title="基础符号"></a>基础符号</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在这里我使用 任意字符 这几个汉字来代表任意数量的任意字符</span></span><br><span class="line"></span><br><span class="line">^    <span class="comment">//匹配开始的位置，如果这个符号像这样[^任意字符]，则代表匹配除了^后的所有字符</span></span><br><span class="line">$    <span class="comment">//匹配结束的位置</span></span><br><span class="line">.    <span class="comment">//匹配除了 \n 的任意字符</span></span><br><span class="line">\n    <span class="comment">//匹配换行符</span></span><br><span class="line">\s    <span class="comment">//匹配任意的空白符,如果s大写，比如 \S ，则取反，匹配任意非空白符</span></span><br><span class="line">\w    <span class="comment">//匹配英文字母与数字和下划线，等于[a-z0-9_],大写则取反</span></span><br><span class="line">\d    <span class="comment">//匹配阿拉伯数字，等于[0-9],大写则取反</span></span><br><span class="line"></span><br><span class="line">|    <span class="comment">// 或</span></span><br><span class="line">*    <span class="comment">//重复0次或多次</span></span><br><span class="line">?    <span class="comment">//重复0次或1次</span></span><br><span class="line">+    <span class="comment">//最少重复1次，或多次</span></span><br><span class="line">&#123;<span class="number">1</span>&#125;    <span class="comment">//重复1次，花括号内可以是任意数字</span></span><br><span class="line">&#123;<span class="number">1</span>,&#125;    <span class="comment">//最少重复1次，或多次，花括号内可以是任意数字</span></span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">9</span>&#125;    <span class="comment">//重复1次到9次，花括号内可以是任意数字</span></span><br></pre></td></tr></table></figure>
<p>下面我们尝试用两个小的示例来概述这部分知识</p>
<h4 id="手机号匹配"><a href="#手机号匹配" class="headerlink" title="手机号匹配"></a>手机号匹配</h4><p>基于我们对以上基础符号的理解，已经可以解决一大半常见的问题，比如手机号码验证的正则，我们先简单粗暴的认为它就是11位数字，直接 <code>\d{11}</code> 就可以满足最基本的需求，但事情往往没有那么简单，比如 <code>12345678910</code> 就可以匹配该正则，而这并不是一个有效的电话号码。</p>
<p>进一步优化则可以这样 <code>^1[3-9]\d{9}$</code> ,表示以1打头的第二个数字是3-9范围内的数字后面再跟9位数字，这个正则就包含了当前国内当前各大运营商及虚拟运营商的所有号段，已经可以满足前端简单的过滤需求了。</p>
<p>如果要再往深了挖，尝试了解已分配号段的区间，可以进一步优化到这步 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^(13\d|14[5-9]|15[0-35-9]|166|17[0-8]|18\d|19[8-9])\d&#123;8&#125;$</span><br></pre></td></tr></table></figure>
<p>做到了手机号前三位数字的匹配，优点是我们已经涵盖了当前的大部分后缀，匹配更加精准，缺点在于这个需要随着运营商号段的新增来进行更新，也许某个客户使用新号段就无法在你的网站或app中注册了呢。这个利益的权衡就在于你自己了。虽然这个正则还有再优化下去的空间，比如了解号段后面的区域划分规则……，但是这样再究下去就实属吃力不讨好了。</p>
<h4 id="trim方法的实现"><a href="#trim方法的实现" class="headerlink" title="trim方法的实现"></a>trim方法的实现</h4><p>再来举个更常见的例子，我们在开发中经常需要使用 <code>trim</code> 方法来去除字符串两边的空格，那么在没有 <code>trim</code> 方法的环境中该怎么做呢？或者说如何实现一个 <code>trim</code> 方法呢？</p>
<p>考虑到是需要在字符串开始和结束的位置匹配空白符，那么我们可以尝试 <code>^\s|\s$</code> ,结果发现只能过滤一个前后空白符，而我们是需要匹配至少一个，最多无数个空白符，那么结合上面的基础符号，我们有两种解决方案 <code>{1,}</code> 或者 <code>+</code> ,那为了方便美观我们采用 <code>^\s+|\s+$</code> 。</p>
<p>参考mdn对js中trim方法的封装<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">String</span>.prototype.trim) &#123;</span><br><span class="line">  <span class="built_in">String</span>.prototype.trim = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g</span>, <span class="string">''</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>提取出核心部分 <code>this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, &#39;&#39;)</code> ，这里对正则匹配到的前后空白符进行了替换处理。</p>
<p>如果只看正则的话，只有 <code>/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g</code> ，这部分是全局匹配各种空字符打头和结尾，从核心思想上与我们上面的实现并无二致，无非是多兼容了部分新增的特殊空字符。</p>
<hr>
<h3 id="捕获及位置"><a href="#捕获及位置" class="headerlink" title="捕获及位置"></a>捕获及位置</h3><p>对于大部分前端，只需要知道基础部分，就能解决大部分问题了。这一部分内容相对来说属于进阶部分，毕竟js对正则的支持直到ES2018（ES9）才算是比较完善了，等到浏览器统一兼容还有比较长的时间。</p>
<p>首先我们列出这部分即将出现的一些正则语法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里我使用 regexp 来表示一段正则代码</span></span><br><span class="line"></span><br><span class="line">(regexp)    <span class="comment">//表示捕获了regexp这段正则匹配的内容，并自动命名为$1,$2,$3……</span></span><br><span class="line">(?<span class="xml"><span class="tag">&lt;<span class="name">name</span>&gt;</span>regexp)   //表示捕获了regexp这段正则匹配的内容，并手动命名为name</span></span><br><span class="line"></span><br><span class="line"><span class="xml">(?=regexp)    //表示匹配regexp这段正则前面的位置</span></span><br><span class="line"><span class="xml">(?<span class="tag">&lt;<span class="name">=regexp)</span>    //表示匹配<span class="attr">regexp</span>这段正则后面的位置</span></span></span><br><span class="line"><span class="xml">(?!regexp)    //表示匹配后面跟的是不匹配regexp这段正则的位置</span></span><br><span class="line"><span class="xml">(?<span class="meta">&lt;!regexp)    //表示匹配前面是不匹配regexp这段正则的位置</span></span></span><br></pre></td></tr></table></figure>
<p>接下来我将尝试用密码验证的例子来巩固这块的知识</p>
<h4 id="一道面试题"><a href="#一道面试题" class="headerlink" title="一道面试题"></a>一道面试题</h4><p>将<code>12345678910</code>转为<code>123,456,789,10</code></p>
<p>一般这种题考点都是我们对于字符串或数字的基本操作，可能通过各种转，换循环和<code>Math</code>的计算最终能解出来，但是了解了正则之后的我们试着对这道题“骚操作”一下：</p>
<p><code>&#39;12345678910&#39;.replace(/(\d{3})/g,&#39;$1,&#39;)</code></p>
<p>只需要一行就可以实现，这里的 <code>$1</code> 就是正则括号里匹配的三位数字，使用 <code>replace</code> 实现替换，从而一行代码搞定。</p>
<p>这里其实还牵扯到一个表达式匹配引用的概念，我们用一个标签匹配来简单分析一下：</p>
<p><code>/^\&lt;([^\&gt;]+)\&gt;.*?\&lt;\/\1\&gt;$/.test(&#39;&lt;div&gt;content&lt;/div&gt;&#39;)</code></p>
<p>表达式中，后面的 <code>\1</code> 引用的就是前面括号中匹配的字符，这里表示匹配 <code>div</code> </p>
<h4 id="位置匹配"><a href="#位置匹配" class="headerlink" title="位置匹配"></a>位置匹配</h4><p>在了解这块之前，我们要清楚一个概念，这个表达式匹配的只是一个位置，一个位置，位置。重要的话说三遍。</p>
<p>无论前端或后端都会碰到密码验证的问题，一般情况使用框架来解决是比较完善的方案，可能会出现因为一个小功能而引入一个庞大的库这种问题。虽然大部分程序员都知道这类字符串验证问题都可以用正则解决，可如何解决就成了问题，所以这就凸显了我记录一下这个知识点的重要性。</p>
<p>密码验证需求1：需要以大写字母开头，且包含字母数字的组合，8-16位。</p>
<p><code>/^[A-Z]((?=.*?\d)|(?=.*?\d)(?=.*?[A-Za-z]))[0-9A-Za-z]{7,16}$/</code></p>
<p>上面这个正则可以实现我们的需求，也不难理解，值得注意的是括号内的东西，首先我们知道 <code>(?=regexp)</code> 表示匹配regexp这段正则前面的“位置”，然后 <code>.*?\d</code>表示任意0或多个字符与数字，那么这句正则的含义就是： 匹配必须包含一位数字前面的“位置”。所以这两个括号表示的仅仅就是两个这样的位置而已，在某些可视化的输出中，我们可以清楚的看到这个位置。</p>
<p>密码验证需求2：需要以大写字母开头，且包含字母数字特殊字符的两两组合，8-16位。<br>（特殊字符假设我们仅限@#$&amp;*_-）</p>
<p><code>/^[A-Z]((?=.*?\d)|(?=.*?[@#$*_-])|(?=.*?\d)(?=.*?[A-Za-z])|(?=.*?\d)(?=.*?[@#$*_-])|(?=.*?[@#$*_-])(?=.*?[A-Za-z]))[\dA-Za-z@#$&amp;*_-]{7,16}$/</code></p>
<p>虽然表达式长了很多，但可以看到核心是不变的，只是使用了 或 的逻辑将表达式组合了起来。</p>
<p>我们知道js中的 <code>!</code> 是取反的意思，其实正则中也是一样，那我们尝试用反向的思维模式来实现一下上面的两个需求：</p>
<p><code>(?!^\d+$)(?!^[a-zA-Z]+$)^[A-Z][\da-zA-Z]{7,16}$</code></p>
<p><code>(?!^\d+$)(?!^[a-zA-Z]+$)(?!^[@#$*_-]$)^[A-Z][\da-zA-Z@#$*_-]{7,16}$</code></p>
<p>一般越短的代码越难理解，可是代码越长我越不想看。其实结合前面的基础知识，上面这两行真不难理解，<code>(?!^\d+$)</code> 表示匹配一个不能是纯数字从头到尾的“位置”，另一个表示匹配一个不能是纯字母从头到尾的“位置”，然后还要大写打头包含数字和字母。<br>第二个无非是增加了一个特殊字符而已</p>
<p>另外的两个反方向的匹配模式无需多讲，只是前后的区别而已，分组命名这块也没有涉及到，是由于目前js对正则语法稀烂的支持性，所以平衡组这块更没有什么可说的，至于DFA和NFA大概了解一下就好。</p>
<div id="paginator"></div><span class="leancloud-visitors" id="技术/My-regular-memo/index.html" data-flag-title="个人正则表达式备忘录"><em class="post-meta-item-text">阅读量 </em><i class="leancloud-visitors-count">1000000+</i></span><div id="valine"> </div></article><nav id="postnav"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础符号"><span class="toc-number">1.</span> <span class="toc-text">基础符号</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#手机号匹配"><span class="toc-number">1.1.</span> <span class="toc-text">手机号匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trim方法的实现"><span class="toc-number">1.2.</span> <span class="toc-text">trim方法的实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#捕获及位置"><span class="toc-number">2.</span> <span class="toc-text">捕获及位置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#一道面试题"><span class="toc-number">2.1.</span> <span class="toc-text">一道面试题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#位置匹配"><span class="toc-number">2.2.</span> <span class="toc-text">位置匹配</span></a></li></ol></li></ol></nav></div></div></div><div id="bottom-outer"><h6 class="mdc-typography--subtitle1">©POWERED BY HEXO | THEME: XUKAI</h6><button class="mdc-fab" id="gotop" aria-label="arrow_upward" data-mdc-auto-init="MDCRipple"><span class="mdc-fab__icon material-icons">arrow_upward</span></button></div><script src="https://cdn.bootcss.com/material-components-web/2.3.1/material-components-web.min.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/js/Valine.min.js"></script><script src="/js/common.js"></script></body></html>